{% extends "base.html" %}

{% block title %}Create Debit{% endblock %}

{% block content %}

<style>
.hidden { display: none; }
#emi-section {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
}
</style>

<div class="col-md-7 mx-auto">

<div class="card shadow">
<div class="card-header bg-primary text-white">
<h4>Create Debit</h4>
</div>

<div class="card-body">
<form method="POST">
{% csrf_token %}

<input class="form-control mb-3" name="lender_name"
       placeholder="Lender Name" required>

<input class="form-control mb-3" type="number" step="0.01"
       name="principal_amount" placeholder="Principal Amount" required>

<input class="form-control mb-3" type="date"
       name="start_date" required>

<textarea class="form-control mb-3"
          name="notes" placeholder="Notes"></textarea>

<div class="form-check mb-3">
<input type="checkbox" class="form-check-input"
       name="is_emi" id="id_is_emi">
<label class="form-check-label">Is EMI?</label>
</div>

<!-- EMI SECTION -->
<div id="emi-section" class="hidden">

<select name="emi_type" id="emi_type"
        class="form-select mb-3">
<option value="">Select EMI Type</option>
{% for value,label in emi_types %}
{% if value != "NO" %}
<option value="{{ value }}">{{ label }}</option>
{% endif %}
{% endfor %}
</select>

<select name="installment_frequency"
        class="form-select mb-3">
<option value="">Select Frequency</option>
{% for value,label in installment_types %}
<option value="{{ value }}">{{ label }}</option>
{% endfor %}
</select>

<input class="form-control mb-3"
       type="number" name="installments"
       placeholder="Number of Installments">

<div id="interest-field">
<input class="form-control mb-3"
       type="number" step="0.01"
       name="emi_interest_rate"
       placeholder="Interest Rate (%)">
</div>

<div id="custom-emi-field" class="hidden">
<input class="form-control mb-3"
       type="number" step="0.01"
       name="emi_amt"
       placeholder="Custom EMI Amount">
</div>

</div>

<button class="btn btn-success w-100 mt-3">
Submit
</button>

</form>
</div>
</div>

</div>

<script>
const isEmi = document.getElementById("id_is_emi");
const emiSection = document.getElementById("emi-section");
const emiType = document.getElementById("emi_type");
const interestField = document.getElementById("interest-field");
const customField = document.getElementById("custom-emi-field");

function toggleEmi() {
    emiSection.classList.toggle("hidden", !isEmi.checked);
}

function toggleType() {
    if (emiType.value === "CUSTOM") {
        interestField.classList.add("hidden");
        customField.classList.remove("hidden");
    } else {
        interestField.classList.remove("hidden");
        customField.classList.add("hidden");
    }
}

isEmi.addEventListener("change", toggleEmi);
emiType.addEventListener("change", toggleType);

toggleEmi();
toggleType();
</script>

{% endblock %}
